import{r as u,j as e}from"./react-D2Uz9C4f.js";import{c as Et}from"./react-dom-JE4wjbQD.js";import{u as Dt,L as q,N as R,B as Nt}from"./react-router-dom-d9ToOv3q.js";import{C as je,c as K}from"./react-hook-form-Dv-Bc-qe.js";import{i as ee}from"./@hookform-DEq2QgbD.js";import{o as z,a as Pt,u as Mt,p as C,m as he,b as ge,c as A,l as Lt,n as xe,d as Ot,e as qt,f as Qe,h as w,i as Ft,r as Wt,j as Ht,k as Yt,q as Vt,t as Qt}from"./valibot-CrV1I3_1.js";import{P as a}from"./prop-types-C3fnT2fs.js";import{r as Gt,P as zt,B as I,t as E,a as F,v as Ge,w as ze,x as Ke,y as $e,z as Ze,D as Xe,E as Kt,G as $t,H as Je,J as Zt,I as Xt,K as Jt,N as _t,O as be,Q as es,U as Me,b as ts,V as ss,W as os,X as rs,Y as Ae,Z as M,_ as Z,L as H,$ as ns,a0 as Le,a1 as L,a2 as ce,a3 as _e,a4 as Y,a5 as V,a6 as Q,a7 as et,a8 as tt,a9 as st,aa as as,ab as is,ac as cs,ad as ls}from"./@mui-KZRTaAo8.js";import{S as ds,C as us}from"./react-select-CBApuTP8.js";import{r as ms,O as _}from"./react-hook-form-mui-YeT5x-M6.js";import{a as S}from"./axios-B4uVmeYG.js";import{c as de,e as ot,b as ps,f as hs,g as D,h as Oe}from"./react-router-C_lQfriH.js";import{s as gs}from"./mui-file-input-D_QNVRNE.js";import"./@babel-5lteqVtP.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-CyxMdkWl.js";import"./clsx-B-dksMZM.js";import"./react-is-DcfIKM1A.js";import"./@popperjs-BQBsAJpH.js";import"./@emotion-In3CLkcT.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./react-transition-group-BtfamiIt.js";import"./@floating-ui-C9hIgVAW.js";import"./use-isomorphic-layout-effect-DQoSZGJU.js";import"./memoize-one-BdPwpGay.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const xs=(t,s)=>{switch(s.type){case"SHOW":return s.payload;case"HIDE":return{message:null,type:"success"};default:return t}},Se=u.createContext(),bs=t=>{const[s,n]=u.useReducer(xs,{message:null,type:"success"});return e.jsx(Se.Provider,{value:[s,n],children:t.children})},fs=()=>u.useContext(Se)[0],ne=()=>u.useContext(Se)[1],ys=(t,s)=>{switch(s.type){case"LOGIN":return s.payload;case"LOGOUT":return null;default:return t}},Ie=u.createContext(),js=t=>{const[s,n]=u.useReducer(ys,null);return e.jsx(Ie.Provider,{value:[s,n],children:t.children})},te=()=>u.useContext(Ie)[0],rt=()=>u.useContext(Ie)[1],ws={button:{color:"white"},ul:{"& .MuiPaginationItem-root":{color:"white","&.Mui-selected":{background:"#609b76"},"&:hover":{backgroundColor:"rgba(96, 155, 118, 0.5)"}}}},nt=({pages:t,page:s,setPage:n,pageChange:r})=>{const o=async(i,c)=>{n(c),r(i,c)};return t===-1?"":e.jsx(Gt,{spacing:2,children:e.jsx(zt,{count:t>10?10:t,page:s,onChange:o,sx:ws})})};nt.propTypes={pages:a.number.isRequired,page:a.number.isRequired,setPage:a.func.isRequired,pageChange:a.func.isRequired};const qe=[{value:28,label:"Action"},{value:12,label:"Adventure"},{value:16,label:"Animation"},{value:35,label:"Comedy"},{value:80,label:"Crime"},{value:99,label:"Documentary"},{value:18,label:"Drama"},{value:10751,label:"Family"},{value:14,label:"Fantasy"},{value:36,label:"History"},{value:27,label:"Horror"},{value:10402,label:"Music"},{value:9648,label:"Mystery"},{value:10749,label:"Romance"},{value:878,label:"Science Fiction"},{value:10770,label:"TV Movie"},{value:53,label:"Thriller"},{value:10752,label:"War"},{value:37,label:"Western"}],ue=({isSubmitting:t,label:s,submittingText:n,normalText:r})=>e.jsx(I,{type:"submit",disabled:t,"aria-label":s,variant:"contained",size:"small",sx:{backgroundColor:"#609b76","&:hover":{backgroundColor:"#00532f"},marginBottom:1},children:t?n:r});ue.propTypes={isSubmitting:a.bool.isRequired,label:a.string.isRequired,submittingText:a.string.isRequired,normalText:a.string.isRequired};const we=({name:t,label:s,control:n})=>e.jsx(ms,{name:t,label:s,control:n,sx:{color:"#609b76"},max:10,min:0,marks:!0,valueLabelDisplay:"auto"});we.propTypes={name:a.string.isRequired,label:a.string.isRequired,control:a.object.isRequired};const vs={label:{color:"#0A6847"},input:{color:"#0A6847"},"& label.Mui-focused":{color:"#0A6847"},"& label.Mui-error":{fontWeight:"bold"},"& .MuiInput-underline:after":{borderBottomColor:"yellow"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#397453"},"&:hover fieldset":{borderColor:"#609b76"},"&.Mui-focused fieldset":{borderColor:"#bdac4e"},"&.Mui-error fieldset":{borderWidth:2}}},J=({name:t,label:s,control:n})=>e.jsx(_,{name:t,label:s,fullWidth:!0,control:n,margin:"dense",InputProps:{sx:{borderRadius:0}},sx:vs});J.propTypes={name:a.string.isRequired,label:a.string.isRequired,control:a.object.isRequired};const Cs={DropdownIndicator:null},Fe={control:(t,{isFocused:s})=>({...t,backgroundColor:"inherit",borderColor:s?"#bdac4e":"#0A6847",borderWidth:s?"2px":"1px",boxShadow:"60px teal",borderRadius:0,padding:"0.6em 0em","&:hover":{borderColor:"#609b76"}}),placeholder:t=>({...t,color:"#0A6847",fontWeight:400}),menuPortal:t=>({...t,zIndex:9999}),option:t=>({...t,color:"#0A6847"})},at=({control:t,handleKeyDown:s,isSubmitting:n,actor:r,actors:o,setActor:i,setActors:c,handleSubmit:d})=>e.jsx("form",{onSubmit:d,children:e.jsxs(E,{spacing:1,sx:{padding:"1em"},children:[e.jsxs("div",{children:[e.jsx(je,{name:"genresSelect",control:t,render:({field:l})=>e.jsx(ds,{...l,styles:Fe,options:qe,menuPortalTarget:document.body,isMulti:!0,placeholder:"Select genres"})}),e.jsx(J,{name:"director",label:"Director",control:t}),e.jsx(J,{name:"year",label:"Year",control:t}),e.jsxs("div",{children:[e.jsx(F,{sx:{paddingBottom:"0.5em",color:"#0A6847"},children:"Rating range"}),e.jsx(we,{name:"ratingLower",label:"Lower threshold",control:t}),e.jsx(we,{name:"ratingUpper",label:"Upper threshold",control:t})]})]}),e.jsx("div",{"data-testid":"actor-input",children:e.jsx(je,{name:"actorsSelect",control:t,render:({field:l})=>e.jsx(us,{...l,components:Cs,options:qe,inputValue:r,isMulti:!0,isClearable:!0,menuIsOpen:!1,placeholder:"Type in actor and press enter",onChange:m=>c(m),onInputChange:m=>i(m),onKeyDown:s,value:o,styles:Fe})})}),e.jsx("div",{children:e.jsx(J,{name:"country",label:"Country",control:t})}),e.jsx(ue,{isSubmitting:n,label:"Search for movies",submittingText:"Searching...",normalText:"Search"})]})});at.propTypes={control:a.object.isRequired,handleKeyDown:a.func.isRequired,isSubmitting:a.bool.isRequired,actor:a.string,actors:a.arrayOf(a.string),setActor:a.func.isRequired,setActors:a.func.isRequired,handleSubmit:a.func.isRequired};const Ue="/api/movies",As=async t=>(await S.post(Ue,t)).data,Ss=async t=>(await S.get(`${Ue}/${t}`)).data,Is=async t=>(await S.post(`${Ue}/title`,t)).data,Te={search:As,getSingleMovie:Ss,searchByTitle:Is},Us=(t,s,n)=>{const{genresSelect:r,director:o,year:i,ratingUpper:c,ratingLower:d,country:l}=t,m=s.map(h=>h.value);return{genres:r?r==null?void 0:r.map(h=>`${h.value}`):[],director:o,year:i,ratingUpper:Number(c),ratingLower:Number(d),actors:m,country:l,page:n}},it=t=>({label:t,value:t}),Ts=t=>{const s={genresSelect:t.genres?t.genres.split(",").map(r=>({label:r,value:r})):[],director:t.director||"",year:t.year||"",ratingUpper:Number(t.ratingUpper||10),ratingLower:Number(t.ratingLower||0),country:t.country||""},n=t.actors?t.actors.split(",").map(r=>it(r)):[];return{parsedData:s,parsedActors:n}},Bs=(t,s)=>{const[n,r]=Dt(),[o,i]=u.useState(""),[c,d]=u.useState([]),[l,m]=u.useState(null),[p,g]=u.useState(1),[h,x]=u.useState(-1),[b,f]=u.useState(!1);u.useEffect(()=>{const T=Object.fromEntries([...n]);if(Object.keys(T).length>0){const{parsedData:N,parsedActors:W}=Ts(T);m(N),d(W),g(Number(T.page||1)),j(N,Number(T.page||1))}},[n]);const j=async(T,N)=>{m(T);const W=Us(T,c,N);r({...W,genres:W.genres.join(","),actors:W.actors.join(","),page:N});const{movieToFrontObjectArray:De,totalPages:Ne}=await Te.search(W);x(Ne),t(De),f(!1)};return{handleKeyDown:T=>{if(o)switch(T.key){case"Enter":case"Tab":d(N=>[...N,it(o)]),i(""),T.preventDefault()}},handleNewSearch:()=>{s(),d([]),g(1),x(-1),t([]),r({})},searchForMovies:j,firstSearchData:l,page:p,totalPages:h,open:b,actor:o,actors:c,setActor:i,setActors:d,setPage:g,setOpen:f}},Rs={backgroundColor:"#609b76","&:hover":{backgroundColor:"#00532f"},marginLeft:"1.15em",marginRight:"1.15em"},ks={width:650,borderRadius:"md",p:3,boxShadow:"lg",bgcolor:"#F6E9B2"},Es={margin:2,backgroundColor:"#F7E382",color:"#00532f","&:hover":{backgroundColor:"#BDAC4E"}},Ds=z({genresSelect:Pt(Ot(z({label:A("Genre label should be a string"),value:xe("Genre value should be a number")}))),year:Mt([C(A(),ge("1874","Movies can not be shot before 1874"),he(`${new Date().getFullYear()}`,"Can not search for movies shot after current year")),Lt("")]),ratingUpper:C(xe("Rating should be a number"),ge(0,"Rating can not be lower than 0"),he(10,"Rating can not be higher than 10")),ratingLower:C(xe("Rating should be a number"),ge(0,"Rating can not be lower than 0"),he(11,"Rating can not be higher than 10")),country:C(A("Country should be a string"),qt(100,"Country name can not be this long")),director:A("Director should be a string")}),ct=({setMovies:t})=>{const{handleSubmit:s,control:n,formState:{isSubmitting:r},reset:o}=K({resolver:ee(Ds),defaultValues:{genresSelect:[],director:"",year:"",ratingLower:0,ratingUpper:10,country:""}}),{handleKeyDown:i,handleNewSearch:c,searchForMovies:d,firstSearchData:l,page:m,totalPages:p,open:g,actor:h,actors:x,setActor:b,setActors:f,setPage:j,setOpen:U}=Bs(t,o);return e.jsxs("div",{className:"searchPage",children:[e.jsx(I,{variant:"contained",onClick:()=>U(!0),sx:Rs,children:"Open Search"}),e.jsx(Ge,{"aria-labelledby":"modal-title","aria-describedby":"modal-desc",open:g,onClose:()=>U(!1),sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(ze,{variant:"outlined",sx:ks,children:[e.jsx(Ke,{variant:"plain",sx:{marginLeft:1}}),e.jsx(at,{control:n,handleKeyDown:i,isSubmitting:r,actor:h,actors:x,setActor:b,setActors:f,handleSubmit:s(y=>d(y,1))})]})}),e.jsx(I,{onClick:c,variant:"contained",sx:Es,children:"clear search"}),e.jsx(nt,{pages:p,page:m,setPage:j,pageChange:(y,T)=>d(l,T)})]})};ct.propTypes={setMovies:a.func.isRequired};const le="/assets/posterPlaceholder-I1zggZYb.png",Ns=t=>({borderColor:"#BDAC4E","&:hover":{borderColor:"#BDAC4E",backgroundColor:t?"#BDAC4E":"primary"},backgroundColor:t?"#BDAC4E":"primary",borderWidth:2,fontSize:11,paddingLeft:2,paddingRight:2,color:"white",marginRight:1.5,boxShadow:"1px 1px 2px rgba(13, 4, 2, 1)"}),G=({unpressedText:t,pressedText:s,onButtonPress:n,onButtonUnpress:r,movieId:o,user:i})=>{const[c,d]=u.useState(()=>JSON.parse(localStorage.getItem(`pressed ${t} ${o} ${i==null?void 0:i.username}`))??!1);u.useEffect(()=>{localStorage.setItem(`pressed ${t} ${o} ${i==null?void 0:i.username}`,JSON.stringify(c))},[o,i==null?void 0:i.username,c,t]);const l=p=>{try{d(!c),n(p)}catch(g){console.log(g)}},m=p=>{try{d(!c),r(p)}catch(g){console.log(g)}};return e.jsx(I,{variant:c?"contained":"outlined",size:"small",color:c?"success":"primary",sx:()=>Ns(c),onClick:c?m:l,children:c?s:t})};G.propTypes={unpressedText:a.string.isRequired,pressedText:a.string.isRequired,onButtonPress:a.func.isRequired,onButtonUnpress:a.func.isRequired,movieId:a.oneOfType([a.number,a.string]),user:a.object};const Ps="https://image.tmdb.org/t/p/original",lt=({movie:t,onButtonPress:s,onButtonUnpress:n,user:r})=>{const[o,i]=u.useState(!1),c=(l,m)=>{s(l,m,{id:t.id,title:t.title,poster:t.image})},d=(l,m)=>{n(l,m,{id:t.id})};return e.jsxs($e,{sx:{width:250,height:375,borderRadius:5,marginBottom:3,textAlign:"center",backgroundColor:"#549a71"},className:"movieCard","data-testid":"search-movie-card",children:[e.jsx(Ze,{component:q,to:`/movies/${t.id}`,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Xe,{component:"picture",sx:{objectFit:"contain"},children:e.jsx("img",{src:o&&t.image?`${Ps}${t.image}`:le,alt:t.image?`${t.title}`:`${t.title} poster Icon made by Freepik from www.flaticon.com`,height:"375",loading:"lazy",onLoad:()=>i(!0)})}),e.jsx(Kt,{sx:{background:"linear-gradient(to top, rgba(0,0,0,0.4), rgba(0,0,0,0) 200px), linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0) 300px)"}}),e.jsx("div",{style:{position:"absolute",color:"white",bottom:"20%",left:"50%",transform:"translateX(-50%)"},children:e.jsx(F,{gutterBottom:!0,variant:"h5",component:"div",sx:{fontWeight:"bold",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)",color:"#f7e382"},children:t.title})})]})}),r?e.jsxs($t,{children:[e.jsx(G,{unpressedText:"Watch",pressedText:"Unwatch",movieId:t.id,user:r,onButtonPress:l=>c(l,"later"),onButtonUnpress:l=>d(l,"later")}),e.jsx(G,{unpressedText:"Favorite",pressedText:"Unfavorite",onButtonPress:l=>c(l,"favorite"),onButtonUnpress:l=>d(l,"favorite"),movieId:t.id,user:r}),e.jsx(G,{unpressedText:"Seen",pressedText:"Unsee",onButtonPress:l=>c(l,"watched"),onButtonUnpress:l=>d(l,"watched"),movieId:t.id,user:r})]}):""]})};lt.propTypes={movie:a.object.isRequired,onButtonPress:a.func.isRequired,onButtonUnpress:a.func.isRequired,user:a.object};const dt=({movies:t,onButtonPress:s,onButtonUnpress:n})=>{const r=te();if(!t)return e.jsx(e.Fragment,{children:"no movies yet"});const o=t;return e.jsx("div",{className:"listContainer",children:e.jsx("div",{className:"cardsContainer",children:o==null?void 0:o.map(i=>e.jsx(lt,{movie:i,onButtonPress:s,onButtonUnpress:n,user:r},i.id?i.id:i.tmdbId))})})};dt.propTypes={movies:a.arrayOf(a.object).isRequired,onButtonPress:a.func.isRequired,onButtonUnpress:a.func.isRequired};const ut=({goToSearch:t})=>e.jsx("div",{className:"scroll-top-button",children:e.jsx(Je,{onClick:t,sx:{opacity:"0.7",marginLeft:"1em",marginBottom:"1em"},children:e.jsx(Zt,{})})});ut.propTypes={goToSearch:a.func};const We={backgroundColor:"#00A660","&:hover":{backgroundColor:"#00755F"},fontSize:20,"@media (max-width: 1024px)":{fontSize:15}},mt=({goToSearch:t})=>{const s=de();return e.jsxs("div",{className:"hero",children:[e.jsx("div",{className:"box2"}),e.jsx("div",{className:"box1",children:e.jsxs("div",{className:"intro",children:[e.jsxs("h2",{children:["Welcome to ",e.jsx("strong",{children:"Kinology"})]}),e.jsx("div",{children:e.jsx("p",{children:"Choosing a movie made easy"})}),e.jsxs("div",{className:"cta-with-buttons",children:[e.jsxs("div",{className:"search-div",children:["Pick actors, directors or genres ",e.jsx("br",{})," then"," ",e.jsx("strong",{children:"explore"}),e.jsx("div",{className:"searchButton",children:e.jsx(I,{className:"CTA-search",variant:"contained",sx:We,onClick:t,children:"Search"})})]}),e.jsxs("div",{className:"register-div",children:[e.jsxs("div",{children:["Too many good options to choose from?",e.jsx("br",{})," Create an account to save movies for later!"]}),e.jsx("div",{className:"registerButton",children:e.jsx(I,{className:"CTA-register",variant:"contained",sx:We,onClick:()=>s("/signup"),children:"Register"})})]})]})]})})]})};mt.propTypes={goToSearch:a.func};const Ms={marginLeft:"3em",marginRight:"3em",backgroundColor:"rgba(206, 202, 182, 0.5)",label:{color:"white"},input:{color:"white"},"& label.Mui-focused":{color:"white"},"& label.Mui-error":{fontWeight:"bold"},"& .MuiInput-underline:after":{borderBottomColor:"yellow"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#397453"},"&:hover fieldset":{borderColor:"#609b76"},"&.Mui-focused fieldset":{borderColor:"#bdac4e"},"&.Mui-error fieldset":{borderWidth:2}}},Be=({setMovies:t})=>{const{handleSubmit:s,control:n,formState:{isSubmitting:r,isSubmitSuccessful:o},reset:i}=K({defaultValues:{title:""}});u.useEffect(()=>{o&&i({title:""})},[o,i]);const c=async l=>{const m=await Te.searchByTitle(l);t(m),console.log(m)},d=()=>{i({title:""}),t([])};return e.jsx("form",{onSubmit:s(c),children:e.jsx("div",{className:"title-search-bar",children:e.jsx(_,{name:"title",label:"Search by title",fullWidth:!0,control:n,margin:"dense",InputProps:{sx:{borderRadius:0},endAdornment:e.jsxs(Xt,{position:"end",children:[e.jsx(I,{sx:{color:"white"},onClick:d,children:e.jsx(Jt,{sx:{opacity:"0.7"}})}),e.jsx(Je,{size:"small",type:"submit",sx:{opacity:"0.7"},disabled:r,children:e.jsx(_t,{})})]})},sx:Ms})})})};Be.propTypes={setMovies:a.func.isRequired};const pt=({onButtonPress:t,onButtonUnpress:s})=>{const[n,r]=u.useState([]),o=u.useRef(null),i=()=>{o.current.scrollIntoView({behavior:"smooth",block:"end"})};return e.jsxs(e.Fragment,{children:[e.jsx(mt,{goToSearch:i}),e.jsxs("div",{id:"search-function",ref:o,children:[e.jsx(Be,{setMovies:r}),e.jsx(ct,{setMovies:r}),e.jsx(dt,{movies:n,onButtonPress:t,onButtonUnpress:s}),n.length>0&&e.jsx(ut,{goToSearch:i})]})]})};pt.propTypes={onButtonPress:a.func,onButtonUnpress:a.func};const Ls={textAlign:"center",color:"#f7e382",fontSize:"1rem",backgroundColor:"rgba(155, 0, 10, 0.4)",borderRadius:2.5,paddingBottom:1,marginLeft:2,"&:hover":{backgroundColor:"rgba(155, 0, 10, 0.8)"}},ve=({handleLogout:t})=>e.jsx(I,{onClick:t,sx:Ls,className:"nav-link","data-testid":"logout-button",children:"log out"});ve.propTypes={handleLogout:a.func.isRequired};const Os=240,He=()=>{window.localStorage.removeItem("loggedKinologyUser"),window.location.reload()},ht=t=>{const s=rt(),{window:n}=t,r=te(),[o,i]=u.useState(!1),c=()=>{i(p=>!p)},d=()=>{He(),s({type:"LOGOUT"})},l=e.jsxs(be,{onClick:c,sx:{textAlign:"center"},children:[e.jsx(q,{to:"/",className:"site-title",children:e.jsx(F,{variant:"h6",sx:{my:2},className:"site-title",children:"Kinology"})}),e.jsx(rs,{}),e.jsxs(Ae,{children:[e.jsx(M,{disablePadding:!0,children:e.jsx(Z,{sx:{textAlign:"center"},children:e.jsx(R,{to:"/about",className:"nav-link",children:e.jsx(H,{primary:"About"})})})}),r?e.jsxs(e.Fragment,{children:[e.jsx(M,{disablePadding:!0,children:e.jsx(Z,{sx:{textAlign:"center"},children:e.jsx(R,{to:"/me",className:"nav-link",children:e.jsx(H,{primary:"Me"})})})}),e.jsx(M,{disablePadding:!0,children:e.jsx(Z,{sx:{textAlign:"center"},children:e.jsx(R,{to:"/users",className:"nav-link",children:e.jsx(H,{primary:"Users"})})})}),e.jsx(M,{disablePadding:!0,children:e.jsx(Z,{sx:{textAlign:"center"},children:e.jsx(ve,{handleLogout:He})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{disablePadding:!0,children:e.jsx(Z,{sx:{textAlign:"center"},children:e.jsx(R,{to:"/login",className:"nav-link",children:e.jsx(H,{primary:"Log in"})})})}),e.jsx(M,{disablePadding:!0,children:e.jsx(Z,{sx:{textAlign:"center"},children:e.jsx(R,{to:"/signup",className:"nav-link",children:e.jsx(H,{primary:"Sign up"})})})})]})]})]}),m=n!==void 0?()=>n().document.body:void 0;return e.jsxs(be,{sx:{display:"flex"},children:[e.jsx(es,{component:"nav",sx:{bgcolor:"#549a71"},position:"fixed",children:e.jsxs(Me,{children:[e.jsx(ts,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:c,sx:{mr:2,display:{sm:"none"},color:"#bdac4e"},children:e.jsx(ss,{})}),e.jsx(F,{variant:"h6",component:"div",sx:{flexGrow:1,display:{xs:"none",sm:"block"}},children:e.jsx(q,{to:"/",className:"site-title",children:"Kinology"})}),e.jsxs(be,{sx:{display:{xs:"none",sm:"block"}},children:[e.jsx(R,{to:"/about",className:"nav-link",children:"About"}),r?e.jsxs(e.Fragment,{children:[e.jsx(R,{to:"/me",className:"nav-link",children:"Me"}),e.jsx(R,{to:"/users",className:"nav-link",children:"Users"}),e.jsx(ve,{handleLogout:d})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{to:"/login",className:"nav-link",children:"Log in"}),e.jsx(R,{to:"/signup",className:"nav-link",children:"Sign up"})]})]})]})}),e.jsx(Me,{}),e.jsx("nav",{children:e.jsx(os,{container:m,variant:"temporary",PaperProps:{sx:{bgcolor:"#549a71"}},open:o,onClose:c,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:Os}},children:l})})]})};ht.propTypes={window:a.instanceOf(window.constructor)};const qs="https://image.tmdb.org/t/p/original",Re=({movie:t})=>e.jsx($e,{sx:{maxWidth:110},children:e.jsx(Ze,{component:q,to:`/movies/${t.tmdbId}`,children:e.jsx(Xe,{component:"img",loading:"lazy",height:"150",alt:`${t.title} poster`,src:t!=null&&t.poster?`${qs}${t==null?void 0:t.poster}`:le})})});Re.propTypes={movie:a.object.isRequired};const Fs="/api/contact",Ws=async t=>(await S.post(Fs,t)).data,Hs={sendMessage:Ws},Ys={label:{color:"#0A6847"},input:{color:"#0A6847"},"& label.Mui-focused":{color:"#0A6847"},"& label.Mui-error":{fontWeight:"bold"},"& .MuiInputBase-input":{color:"#0A6847"},"& .MuiInput-underline:after":{borderBottomColor:"yellow"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#397453"},"&:hover fieldset":{borderColor:"#609b76"},"&.Mui-focused fieldset":{borderColor:"#bdac4e"},"&.Mui-error fieldset":{borderWidth:2}}},Vs=z({email:C(A(),w(1,"Please enter your email."),Qe("The email address is badly formatted")),name:C(A(),w(1,"Please enter your name or nickname."),w(3,"Name or nickname should be 3 or more symbols")),message:C(A(),w(1,"Please enter your message"),w(3,"Message should be 3 or more symbols "))}),gt=({setOpen:t})=>{const s=ne(),{handleSubmit:n,reset:r,control:o,formState:{isSubmitting:i,isSubmitSuccessful:c}}=K({resolver:ee(Vs)});u.useEffect(()=>{c&&r({name:"",email:"",message:""})},[c,r]);const d=async l=>{try{await Hs.sendMessage(l),t(!1),s({type:"SHOW",payload:{message:"Your message was sent successfully",type:"success"}}),setTimeout(()=>s({type:"HIDE"}),5e3)}catch{s({type:"SHOW",payload:{message:"Something went wrong when sending your message",type:"error"}}),setTimeout(()=>s({type:"HIDE"}),5e3)}};return e.jsx("form",{onSubmit:n(d),className:"contact-form",children:e.jsxs(E,{spacing:1,sx:{paddingBottom:1},children:[e.jsx(J,{name:"name",label:"Name",control:o}),e.jsx(J,{name:"email",label:"Email",control:o}),e.jsx(_,{name:"message",label:"Your message",multiline:!0,inputProps:{spellCheck:"false"},InputProps:{sx:{borderRadius:0}},minRows:5,maxRows:1/0,sx:Ys,control:o}),e.jsx(ue,{isSubmitting:i,label:"Submit message",submittingText:"Sending message...",normalText:"Send message"})]})})};gt.propTypes={setOpen:a.func.isRequired};const Qs=()=>{const[t,s]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"contained",onClick:()=>s(!0),sx:{backgroundColor:"#609b76","&:hover":{backgroundColor:"#00532f"},marginBottom:1,marginTop:1},children:"Contact Me"}),e.jsx(Ge,{"aria-labelledby":"modal-title","aria-describedby":"modal-desc",open:t,onClose:()=>s(!1),sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(ze,{variant:"outlined",sx:{width:650,borderRadius:"md",p:5,boxShadow:"lg",bgcolor:"#F6E9B2"},children:[e.jsx(gt,{setOpen:s}),e.jsx(Ke,{variant:"plain"})]})})]})},Gs=[{title:"Scarface",poster:"/iQ5ztdjvteGeboxtmRdXEChJOHh.jpg",tmdbId:"111"},{title:"The Godfather Part II",poster:"/hek3koDUyRQk7FIhPXsa6mT2Zc3.jpg",tmdbId:"240"},{title:"The Godfather",poster:"/3bhkrj58Vtu7enYsRolD1fZdja1.jpg",tmdbId:"238"},{title:"Apocalypse Now",poster:"/8LHWi5GWEWKL2adSlNI6bZ4wpUW.jpg",tmdbId:"28"},{title:"Sonatine",poster:"/mX9E4fEuG17L2e7bZmhBc0XdRbw.jpg",tmdbId:"7500"},{title:"Casino",poster:"/4TS5O1IP42bY2BvgMxL156EENy.jpg",tmdbId:"524"},{title:"GoodFellas",poster:"/aKuFiU82s5ISJpGZp7YkIr3kCUd.jpg",tmdbId:"769"},{title:"Easy Rider",poster:"/mmGEB6ly9OG8SYVfvAoa6QqHNvN.jpg",tmdbId:"624"},{title:"Full Metal Jacket",poster:"/kMKyx1k8hWWscYFnPbnxxN4Eqo4.jpg",tmdbId:"600"}],zs=()=>e.jsx("div",{children:e.jsxs("div",{className:"aboutContainer",children:[e.jsxs("div",{className:"box",children:[e.jsx("h2",{children:"About me"}),e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"about-me-info",children:[e.jsx("div",{children:e.jsx("a",{href:"https://github.com/timmchi",target:"_blank","aria-label":"Github profile",children:e.jsx(ns,{sx:{fontSize:"3rem"}})})}),e.jsx("div",{children:e.jsx(Qs,{})})]}),e.jsx("h3",{children:"My favorite movies"}),e.jsx("div",{className:"profileMovieContainer about",children:Gs.map(t=>e.jsx("div",{className:"movieSmallCard",children:e.jsx(Re,{movie:t})},t.tmdbId))})]})]}),e.jsxs("div",{className:"box",children:[e.jsx("h2",{children:"Web app uses TMDB api"}),e.jsxs("div",{className:"content",children:[e.jsx("p",{children:"This website uses TMDB (The Movie Database) api to implement its core functionality, and I am highly thankful to them for providing their api for free."}),e.jsx("p",{children:"TMDB api has great documentation and it is fairly easy to use, so I suggest you give it a shot if you have some web app ideas related to movies."}),e.jsxs("p",{children:["Link to TMDB"," ",e.jsx("a",{href:"https://www.themoviedb.org",target:"_blank","aria-label":"TMDB link",children:e.jsx(Le,{sx:{fontSize:"2rem"}})})]})]})]}),e.jsxs("div",{className:"box",children:[e.jsx("h2",{children:"Fullstack open"}),e.jsxs("div",{className:"content",children:[e.jsx("p",{children:"This website is my submission for the final project part of Full Stack Open course, worth 10 credits or 175 hours."}),e.jsxs("p",{children:[" ","I gained most of my React and Node knowledge through that course, so I highly recommend it to anyone who wants to get better at modern web development."]}),e.jsxs("p",{children:["Link to the course"," ",e.jsx("a",{href:"https://fullstackopen.com/en/",target:"_blank","aria-label":"Fullstackopen link",children:e.jsx(Le,{sx:{fontSize:"2rem"}})})]})]})]})]})}),Ks=z({username:C(A("Username must be a string."),w(1,"Please enter your username."),w(3,"Username needs to be at least 3 characters long.")),password:C(A("Your password must be a string."),w(1,"Password is required."),w(6,"Your password must have 6 characters or more."))}),Ye={bgcolor:"#79C094",input:{color:"white",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)"},borderRadius:0,padding:1.5,"--Input-placeholderOpacity":1,"--Input-focusedInset":"var(--any, )","--Input-focusedThickness":"2px","--Input-focusedHighlight":"#bdac4e !important","&:focus-within":{borderColor:"#bdac4e"}},fe={color:"#f7e382",fontSize:18},Ce=({handleLogin:t})=>{var d,l,m,p;const{register:s,handleSubmit:n,reset:r,formState:{errors:o,isSubmitting:i,isSubmitSuccessful:c}}=K({resolver:ee(Ks)});return u.useEffect(()=>{c&&r({username:"",password:""})},[c,r]),e.jsxs("div",{style:{backgroundColor:"#397453"},children:[e.jsx(L,{sx:{width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)"},children:e.jsx(L,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:e.jsxs(L,{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[e.jsx(E,{gap:4,sx:{mb:2},children:e.jsxs(E,{gap:1,children:[e.jsx(ce,{component:"h1",level:"h3",sx:{color:"#f7e382"},children:"Log in"}),e.jsxs(ce,{level:"body-sm",sx:fe,children:["New to Kinology?"," ",e.jsx(q,{to:"/signup",sx:{color:"#E6E9E0"},children:"Create an account"})]})]})}),e.jsx(_e,{sx:{bgcolor:"#bdac4e"}}),e.jsx(E,{gap:4,sx:{mt:2},children:e.jsxs("form",{onSubmit:n(t),children:[e.jsxs(Y,{children:[e.jsx(V,{sx:fe,children:"Username"}),e.jsx(Q,{...s("username"),placeholder:"Your username","data-testid":"username",sx:Ye}),(d=o==null?void 0:o.username)!=null&&d.message?e.jsx("p",{style:{color:"red"},children:(l=o.username)==null?void 0:l.message}):null]}),e.jsxs(Y,{children:[e.jsx(V,{sx:fe,children:"Password"}),e.jsx(Q,{type:"password",...s("password"),placeholder:"Your password","data-testid":"password",autoComplete:"on",sx:Ye}),(m=o==null?void 0:o.password)!=null&&m.message?e.jsx("p",{style:{color:"red"},children:(p=o.password)==null?void 0:p.message}):null]}),e.jsx(et,{type:"submit",fullWidth:!0,disabled:i,id:"login-button",sx:{fontSize:18},children:i?"Logging in...":"Log In"})]})})]})})}),e.jsx(L,{sx:{height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:"url(https://images.unsplash.com/photo-1589053739346-ed32227546a4?q=80&w=1031&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)"}})]})};Ce.propTypes={handleLogin:a.func.isRequired};const $s="/api/users",Zs=async t=>(await S.post($s,t)).data,Xs={signUp:Zs},Js=t=>{const s=de(),n=ne();return{handleSignUp:async o=>{const{username:i,email:c,password:d,passwordConfirm:l,name:m}=o;try{const p=await Xs.signUp({username:i,email:c,password:d,passwordConfirm:l,name:m});t(p),n({type:"SHOW",payload:{message:"Sign up was successful, please log in",type:"success"}}),setTimeout(()=>n({type:"HIDE"}),5e3),s("/login")}catch{n({type:"SHOW",payload:{message:"Something went wrong when signing up",type:"error"}}),setTimeout(()=>n({type:"HIDE"}),5e3)}}}},_s=C(z({email:C(A(),w(1,"Please enter your email."),Qe("The email address is badly formatted")),username:C(A(),w(1,"Please enter your username."),w(3,"Username should be 3 or more symbols")),name:C(A(),w(1,"Please enter your name or nickname."),w(3,"Name or nickname should be 3 or more symbols")),password:C(A(),w(1,"Please enter your password."),w(8,"Your password must have 8 characters or more."),Wt(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/,"Your password must have one uppercase letter, one lowercase letter and one number")),passwordConfirm:C(A(),w(1,"Please confirm password"))}),Ft(Ht(t=>t.password===t.passwordConfirm,"The two passwords do not match"),["passwordConfirm"])),oe={bgcolor:"#79C094",input:{color:"white",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)"},borderRadius:0,padding:1.5,"--Input-placeholderOpacity":1,"--Input-focusedInset":"var(--any, )","--Input-focusedThickness":"2px","--Input-focusedHighlight":"#bdac4e !important","&:focus-within":{borderColor:"#bdac4e"}},X={color:"#f7e382",fontSize:18},eo={height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:"url(https://images.unsplash.com/photo-1589053739346-ed32227546a4?q=80&w=1031&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)"},xt=({addUser:t})=>{var l,m,p,g,h,x,b,f,j,U;const{register:s,handleSubmit:n,reset:r,formState:{errors:o,isSubmitting:i,isSubmitSuccessful:c}}=K({resolver:ee(_s)});u.useEffect(()=>{c&&r({username:"",email:"",password:"",passwordConfirm:"",name:""})},[c,r]);const{handleSignUp:d}=Js(t);return e.jsxs("div",{style:{backgroundColor:"#397453"},children:[e.jsx(L,{sx:{width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)"},children:e.jsx(L,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:e.jsxs(L,{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[e.jsx(E,{gap:4,sx:{mb:2},children:e.jsxs(E,{gap:1,children:[e.jsx(ce,{component:"h1",level:"h3",sx:{color:"#f7e382"},children:"Sign up"}),e.jsxs(ce,{level:"body-sm",sx:X,children:["Already have an account?"," ",e.jsx(q,{to:"/login",sx:{color:"#E6E9E0"},children:"Sign in"})]})]})}),e.jsx(_e,{sx:{bgcolor:"#bdac4e"}}),e.jsx(E,{gap:4,sx:{mt:2},children:e.jsxs("form",{onSubmit:n(d),children:[e.jsxs(Y,{children:[e.jsx(V,{sx:X,children:"Username"}),e.jsx(Q,{...s("username"),placeholder:"username","data-testid":"username",sx:oe}),(l=o==null?void 0:o.username)!=null&&l.message?e.jsx("p",{style:{color:"red"},children:(m=o.username)==null?void 0:m.message}):null]}),e.jsxs(Y,{children:[e.jsx(V,{sx:X,children:"Name"}),e.jsx(Q,{...s("name"),placeholder:"name","data-testid":"name",sx:oe}),(p=o==null?void 0:o.name)!=null&&p.message?e.jsx("p",{style:{color:"red"},children:(g=o.name)==null?void 0:g.message}):null]}),e.jsxs(Y,{children:[e.jsx(V,{sx:X,children:"Email"}),e.jsx(Q,{...s("email"),placeholder:"email","data-testid":"email",sx:oe}),(h=o==null?void 0:o.email)!=null&&h.message?e.jsx("p",{style:{color:"red"},children:(x=o.email)==null?void 0:x.message}):null]}),e.jsxs(Y,{children:[e.jsx(V,{sx:X,children:"Password"}),e.jsx(Q,{type:"password",...s("password"),placeholder:"password...","data-testid":"password",autoComplete:"on",sx:oe}),(b=o==null?void 0:o.password)!=null&&b.message?e.jsx("p",{style:{color:"red"},children:(f=o.password)==null?void 0:f.message}):null]}),e.jsxs(Y,{children:[e.jsx(V,{sx:X,children:"Confirm Password"}),e.jsx(Q,{type:"password",...s("passwordConfirm"),placeholder:"confirm password","data-testid":"password-confirm",autoComplete:"on",sx:oe}),(j=o==null?void 0:o.passwordConfirm)!=null&&j.message?e.jsx("p",{style:{color:"red"},children:(U=o.passwordConfirm)==null?void 0:U.message}):null]}),e.jsx(et,{type:"submit",fullWidth:!0,disabled:i,id:"signup-button",sx:{fontSize:18},children:i?"Signing up...":"Sign Up"})]})})]})})}),e.jsx(L,{sx:eo})]})};xt.propTypes={addUser:a.func.isRequired};const re=u.forwardRef((t,s)=>{const[n,r]=u.useState(!1),o={display:n?"none":""},i={display:n?"":"none"},c=()=>{r(!n)};return u.useImperativeHandle(s,()=>({toggleVisibility:c})),e.jsxs("div",{children:[e.jsx("div",{style:o,children:e.jsx(I,{variant:"contained",size:"small",sx:{backgroundColor:"#79C094","&:hover":{backgroundColor:"#00532f"}},onClick:c,children:t.buttonLabel})}),e.jsxs("div",{style:i,className:"togglableContent",children:[t.children,e.jsx(I,{variant:"contained",size:"small",sx:{backgroundColor:"#9b000a","&:hover":{backgroundColor:"#730000"}},onClick:c,children:"cancel"})]})]})});re.displayName="TogglableElement";re.propTypes={buttonLabel:a.string.isRequired,children:a.node.isRequired};const to={bgcolor:"#79C094",label:{color:"white"},input:{color:"white",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)"},"& label.Mui-focused":{color:"white"},"& label.Mui-error":{fontWeight:"bold"},"& .MuiInput-underline:after":{borderBottomColor:"yellow"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#397453"},"&:hover fieldset":{borderColor:"white"},"&.Mui-focused fieldset":{borderColor:"#bdac4e"},"&.Mui-error fieldset":{borderWidth:2}}},so=z({content:C(A("Comment must be a string"),w(1,"Comments can not be empty"))}),me=({commentAction:t,commentId:s,authorId:n,label:r})=>{const{handleSubmit:o,reset:i,control:c,formState:{isSubmitting:d,isSubmitSuccessful:l}}=K({resolver:ee(so)});u.useEffect(()=>{l&&i({content:""})},[l,i]);const m=async({content:p})=>{t(p,s,n)};return e.jsx("form",{onSubmit:o(m),children:e.jsxs(E,{spacing:1,sx:{paddingBottom:1,display:"inline-flex"},children:[e.jsx(_,{name:"content",label:r,fullWidth:!0,control:c,margin:"dense",InputProps:{sx:{borderRadius:0}},sx:to}),e.jsx(ue,{isSubmitting:d,label:"Submit comment",submittingText:"Commenting...",normalText:"Submit comment",id:"comment-button"})]})})};me.propTypes={commentAction:a.func,commentId:a.string,authorId:a.string,label:a.string};const oo=z({bio:C(A("About you should be a string"),w(1,"Please enter something about yourself.")),name:C(A("Name should be a string"),w(1,"Please enter your name"),w(3,"Name should be 3 or more symbols long")),avatar:C(Vt(File),Yt(["image/jpeg","image/png","image/jpg","image/svg"]),Qt(1024*1024*2))}),ye={bgcolor:"#79C094",label:{color:"white",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)"},input:{color:"white",textShadow:"1px 1px 2px rgba(13, 4, 2, 1)"},"& label.Mui-focused":{color:"white"},"& label.Mui-error":{fontWeight:"bold"},"& .MuiInput-underline:after":{borderBottomColor:"yellow"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#397453"},"&:hover fieldset":{borderColor:"white"},"&.Mui-focused fieldset":{borderColor:"#bdac4e"},"&.Mui-error fieldset":{borderWidth:2}}},bt=({updateUser:t})=>{const{handleSubmit:s,control:n,formState:{isSubmitting:r,isSubmitSuccessful:o},reset:i}=K({resolver:ee(oo)});u.useEffect(()=>{o&&i({bio:"",name:"",avatar:null})},[o,i]);const c=d=>{console.log(d.avatar),console.log(d);const l=new FormData;l.append("avatar",d.avatar),l.append("bio",d.bio),l.append("name",d.name),t(l)};return e.jsx("form",{onSubmit:s(c),children:e.jsxs(E,{spacing:1,sx:{paddingBottom:1,paddingRight:1,maxWidth:"310px"},children:[e.jsx(_,{name:"bio",label:"About you",fullWidth:!0,control:n,margin:"dense",InputProps:{sx:{borderRadius:0}},sx:ye}),e.jsx(_,{name:"name",label:"Name",fullWidth:!0,control:n,margin:"dense",InputProps:{sx:{borderRadius:0}},sx:ye}),e.jsx(F,{children:"Upload Avatar"}),e.jsx(je,{name:"avatar",control:n,render:({field:d})=>e.jsx(gs,{...d,inputProps:{accept:".png, .jpeg, .jpg, .svg"},InputProps:{sx:{borderRadius:0}},placeholder:"Insert a file",sx:ye})}),e.jsx(I,{disabled:r,type:"submit",id:"update-button",variant:"contained",size:"small",sx:{backgroundColor:"#609b76","&:hover":{backgroundColor:"#00532f"},marginBottom:1},children:r?"Updating...":"Update your profile"})]})})};bt.propTypes={updateUser:a.func.isRequired};const ie=({movies:t,header:s})=>{const n=t;return e.jsxs("div",{className:"movieList",style:{display:n.length===0?"none":""},children:[e.jsx("h3",{children:s}),e.jsx("div",{className:"profileMovieContainer",children:n==null?void 0:n.map(r=>e.jsx("div",{className:"movieSmallCard",children:e.jsx(Re,{movie:r})},`${r.id?r.id:r.tmdbId} header`))})]})};ie.propTypes={movies:a.arrayOf(a.object).isRequired,header:a.string};const $="/api/users";let ae=null;const ro=t=>{ae=`Bearer ${t}`},no=async()=>(await S.get($)).data,ao=async t=>(await S.get(`${$}/${t}`)).data,io=async t=>(await S.get(`${$}/${t}/avatar`)).data,co=async(t,s,n)=>{const r={headers:{Authorization:ae}};return(await S.post(`${$}/${n}/movies`,{movie:t,button:s},r)).data},lo=async(t,s,n)=>{const r={headers:{Authorization:ae},data:{button:s}};return(await S.delete(`${$}/${n}/movies/${t.id}`,r)).data},uo=async(t,s)=>{const n={headers:{Authorization:ae,"Content-Type":"multipart/form-data"}};return(await S.put(`${$}/${t}`,s,n)).data},mo=async t=>{const s={headers:{Authorization:ae}};return(await S.delete(`${$}/${t}`,s)).data},k={setToken:ro,getUsers:no,getUser:ao,addMovieToProfile:co,updateUser:uo,deleteUser:mo,removeMovieFromProfile:lo,getUserAvatar:io},ft=({comment:t,editForm:s,onDelete:n})=>{var c,d,l,m,p,g,h,x;const[r,o]=u.useState(""),i=te();return u.useEffect(()=>{(async()=>{var j;const f=await k.getUserAvatar((j=t.author)==null?void 0:j.id);o(f)})()},[(c=t.author)==null?void 0:c.id]),e.jsxs("div",{className:"singleComment",children:[e.jsxs(M,{alignItems:"flex-start",component:q,to:t.author?`/users/${(d=t.author)==null?void 0:d.id}`:"/users",children:[e.jsx(tt,{children:e.jsx(st,{alt:(l=t.author)==null?void 0:l.name,src:r})}),e.jsx(H,{primary:((m=t.author)==null?void 0:m.name)??"Deleted user",secondary:t.content,sx:{color:"#F7E382"},secondaryTypographyProps:{color:"white"}}),e.jsx(F,{children:t.createdAt?new Date(t.createdAt).toLocaleString():""})]}),e.jsx("div",{className:"commentButtons",children:i&&e.jsxs(e.Fragment,{children:[i.username===((p=t.author)==null?void 0:p.username)&&e.jsxs(e.Fragment,{children:[s(t.id,(g=t.author)==null?void 0:g.id),e.jsx(I,{variant:"contained",size:"small",onClick:()=>{var b;return n(t.id,(b=t.author)==null?void 0:b.id)},sx:{backgroundColor:"#9b000a","&:hover":{backgroundColor:"#730000"},marginLeft:2,alignSelf:"start"},children:"Delete comment"})]}),i.username===((h=t.receiver)==null?void 0:h.username)&&i.username!==((x=t.author)==null?void 0:x.username)&&e.jsx(I,{variant:"contained",size:"small",onClick:()=>{var b;return n(t.id,(b=t.author)==null?void 0:b.id)},sx:{backgroundColor:"#9b000a","&:hover":{backgroundColor:"#730000"}},children:"Delete comment"})]})})]})};ft.propTypes={comment:a.object,editForm:a.func,onDelete:a.func};const yt=({onSort:t,sortDesc:s})=>e.jsxs("div",{className:"sort-comments",children:[e.jsx(I,{sx:{color:"#bdac4e"},children:e.jsx(as,{onClick:t})}),e.jsxs(F,{sx:{paddingTop:"0.5em"},children:["Sorting by: ",s?"Newest first":"Oldest first"]})]});yt.propTypes={onSort:a.func.isRequired,sortDesc:a.bool.isRequired};const po=(t,s)=>t==null?void 0:t.slice().sort((r,o)=>{const i=new Date(r.createdAt),c=new Date(o.createdAt);return s?c-i:i-c}),ke=({comments:t,onEdit:s,onDelete:n})=>{const r=u.useRef(),[o,i]=u.useState(!0);if(!t||t.length===0)return e.jsx(F,{variant:"h5",sx:{paddingTop:2},children:"No comments yet..."});const c=(m,p,g)=>{r.current.toggleVisibility(),s(p,m,g)},d=(m,p)=>e.jsx(re,{buttonLabel:"edit comment",ref:r,children:e.jsx(me,{commentAction:c,commentId:m,authorId:p,label:"Edit your comment"})}),l=po(t,o);return e.jsxs(e.Fragment,{children:[e.jsx(yt,{sortDesc:o,onSort:()=>i(!o)}),e.jsx(Ae,{sx:{width:"100%",maxWidth:600,backgroundColor:"#397453"},children:l.map(m=>e.jsx("div",{children:e.jsx(ft,{comment:m,editForm:d,onDelete:n})},m.id))})]})};ke.propTypes={comments:a.arrayOf(a.object),onEdit:a.func,onDelete:a.func};const jt=({currentUser:t,commentCreateForm:s,comments:n,deleteComment:r,updateComment:o})=>e.jsxs("div",{className:"userProfileComments",children:[e.jsx("h2",{children:"Comments"}),e.jsx("div",{className:"profileCommentTogglable",children:t&&s()}),e.jsx(ke,{comments:n,onDelete:r,onEdit:o})]});jt.propTypes={currentUser:a.object,commentCreateForm:a.func.isRequired,comments:a.arrayOf(a.object),deleteComment:a.func.isRequired,updateComment:a.func.isRequired};const wt=({name:t,biography:s})=>e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:e.jsx("strong",{children:t===""||!t?"Anonymous user":t})}),e.jsxs("div",{children:[e.jsx("h2",{children:"About me"}),e.jsx("p",{children:s===""||!s?"We don't know anything about them yet":s})]})]});wt.propTypes={name:a.string,biography:a.string};const vt=({user:t,updateForm:s,deleteUser:n})=>{const r=te();return e.jsx("div",{className:"profileButtons",children:r&&(r==null?void 0:r.username)===t.username&&e.jsxs(e.Fragment,{children:[s(),e.jsx(I,{sx:{backgroundColor:"#9b000a","&:hover":{backgroundColor:"#730000"},alignSelf:"start"},variant:"contained",size:"small",onClick:n,children:"Delete user"})]})})};vt.propTypes={user:a.oneOfType([a.object,a.string]),updateForm:a.func.isRequired,deleteUser:a.func.isRequired};const Ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAYAAAB5fY51AAAACXBIWXMAAC4jAAAuIwF4pT92AAAPCUlEQVR4nO3daXPaVhuA4QcQiMXsizG4deJpkv//c5LYbt2ExcYYhG2M2PR+eCeeSZM2tlmOnqP7msmHtpP46SHcCCGOYufn54EAgAJx0wMAwHMRLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqECwAahAsAGoQLABqOKYHgB6+78t0OpXHx0fxfV9835f1ei2r1erpVyKRePoVj8fFdV1xXVcymYxks1lxXdf0/wYUI1j4V6vVSjzPE8/z5O7uThaLxbN+z2q1evrnh4eH7/57MpmUfD4vxWJRisWiJBKJrc8Ne8XOz88D00MgPIIgEM/zZDgciud5EgS7++sRi8WkWCxKtVqVYrEosVhsZz8LduAICyIisl6vZTAYyPX1tczn8738zCAIZDwey3g8llQqJY1GQ+r1usTjnFrFz3GEFXFBEMj19bX0+31ZLpemxxHHcaTZbEqj0eCICz8gWBHmeZ58+fJFfN83PcoPXNeV4+NjKZVKpkdBiBCsCFoul/L333/LaDQyPcovlctl+e233ySZTJoeBSHAOayI8TxPLi8vn/WJXxiMRiO5v7+Xk5MTKRaLpseBYZzdjJB+vy9nZ2dqYvXNYrGQs7Mz6fV6pkeBYRxhRcB6vZbLy0u5vb01PcpGut2uzGYzOTk54ZPEiCJYllsul3J2dvbDBZxa3d7eiu/78scff4jj8Nc3aniZsthisZCPHz9aE6tvHh4e5OPHj+re2mJzBMtSy+VSPn36JLPZzPQoOzGbzeTTp0+huHYM+0OwLLRareTz58/Wxuqb2Wwmnz9//u67i7AbwbJMEARycXEh0+nU9Ch7MZ1O5eLiYqffeUR4ECzLdDodmUwmpsfYq8lkIp1Ox/QY2AOCZZHRaCRXV1emxzDi6upKxZX72AzBssR8PpfLy0vTYxh1eXkZyu9FYnsIliX+/PPPyJ98Xq1W8tdff5keAztEsCwwGAzk/v7e9BihcH9/L4PBwPQY2BGCpdxiseCE8z90Oh0uKrUUwVKu2+1G/q3gP61WKyJuKYKl2OPjo9zc3JgeI5SGw6E8Pj6aHgNbRrAU63a7pkcINdbHPgRLqel0KuPx2PQYoTYejyNzxX9UECylonqB6EuxTnYhWAotFguu6n6m0WjEJ4YWIVgK3dzc8GXfZwqCgA8mLEKwFBoOh6ZHUIX1sgfBUmY6nfJ9uRfyfZ+T75YgWMpw7up1WDc7ECxleOK9DutmB4KlyOPjI28HX8n3fa58twDBUuTu7s70CKqxfvoRLEV4wm2G9dOPYCli2/0F9431049gKbFYLLhie0OsoX4ESwlOGG8H66gbwVKCJ9p2sI66ESwl5vO56RGswDrqRrCU4Im2HayjbgRLCZ5o28E66kawlOBGE9vBOupGsJRYLpemR7AC66gbwVKCDfu2g3XUjWApsV6vTY9gBdZRN4KlRCwWMz0CYBzBUiIe56HaBtZRNx49JRKJhOkRrMCRqm4ESwmODLbDcRzTI2ADPAuUIFjbwZGqbjwLlEilUqZHsALrqBvBUoIn2nYkk0nTI2ADBEsJgrUdruuaHgEbIFhKZDIZ0yNYgXXUjWApwRNtO1hH3QiWEslkkvMvG2IN9SNYiuRyOdMjqMb66UewFMnn86ZHUI31049gKcITbjOsn34ES5FMJsPH8q/kui4n3C1AsJQpl8umR1CJdbMDwVKGJ97rsG52IFjKZLNZ3ha+kOu6ks1mTY+BLSBYClWrVdMjqMJ62YNgKVSr1diI7plisZjUajXTY2BLCJZCyWSSczLPVC6XubrdIgRLqcPDQ9MjqMA62YVgKZXNZqVUKpkeI9RKpRIn2y1DsBRrtVqmRwg11sc+BEuxTCbDCeV/Ua1WubLdQgRLuVarxY0V/iGRSEi73TY9BnaAYCmXTCZ5cv5Du93mk0FLESwL1Ot1OTg4MD1GKBwcHEi9Xjc9BnaEYFni7du3kX9rmEgk5M2bN6bHwA4RLEukUik5OTkxPYZRJycnfM/ScgTLIuVyObIXSh4eHnL1fwQQLMu0220pFAqmx9irQqHABw8RQbAsE4vF5PT0NDJXeGezWTk9PeXL4BFBsCyUSCTk3bt3kk6nTY+yU+l0Wt69exf5DxuihGBZynEcef/+vbXRSqfT8v79e3Ecx/Qo2COCZbFkMikfPnyw7n58uVxOPnz4wMWhEUSwLPftSKtSqZgeZSsqlQpHVhHGox4B8Xhc3r59K5lMRjqdjulxXq3VasnR0ZHpMWAQwYqQZrMpmUxGLi8vZbFYmB7n2RzHkTdv3kixWDQ9CgyLnZ+fB6aHwH4tFgv58uWLjEYj06P8UqlUkt9//53zVRARghVp4/FYvn79Kr7vmx7lB67ryvHxMbuq4ju8JYywUqkkxWJRrq+vpd/vy3K5ND2SOI4jzWZTGo0GF4PiBxxhQURE1uu1DAYDub6+lvl8vvefn0qlpNFoSL1el3icD6/xcwQL3wmCQDzPk+FwKJ7nSRDs7q9HLBaTYrEo1WpVisUiR1T4Jd4S4juxWExKpZKUSiVZrVbieZ54nid3d3db+WQxmUxKPp+XYrEoxWKRr9XgRTjCwrP5vi/T6VSm06nM53PxfV8Wi4WsVitZr9cSBIHEYjGJx+OSSCQkmUxKKpUS13Ulm81KNptlvypshCMsPJvruuK6LvtOwRjObgJQg2ABUINgAVCDYAFQg2ABUINgAVCDYAFQg2ABUIMLR7EV0+n0aTfTdrsdmduMYb8IFjbi+750u125vb19+neTyUTK5bK0222+ioOtIlh4lcViIb1eT25ubn66o8NoNJLxeCy1Wk2Ojo7YMRRbwZef8SKr1Uqurq7k6upK1uv1s35PPB6Xw8NDOTw8ZHcGbIRg4VmCINh4Z1J2E8WmCBZ+aTgcSrfb3dpOpKlUSlqtllSr1a38eYgOgoV/5XmedDodeXx83Mmfn8lkpN1uc/suPBvBwg8eHh7k69evcn9/v5efd3BwIMfHx5LL5fby86AXwcKT2WwmnU5HxuOxkZ9fKpWk3W5LOp028vMRflzWAJnP59Lr9WQ4HO70phO/Mh6PxfM8qVarcnR0JKlUytgsCCeOsCJsuVxKv9+XwWDw7EsU9iUej0u9XpdmsymOw+sq/o9gRdB6vX66RGG1Wpke5z8lEomnSyG4XyEIVoQEQfB0icI2btm1T8lk8ulSCK7hii6CFRGj0Ui63a7MZjPTo2wknU5Lq9Xizj0RRbAsd3d3J51ORx4eHkyPslW5XE7a7bbk83nTo2CPCJalvm33MplMTI+yU4VCge1sIoSPXyzzs+1ebDaZTGQymUilUpFWq8V2NpYjWJZYLpfS6/VkMBgYvZbKlNvbWxmNRk+XQrCdjZ14S6jcer2Wfr//ou1ebPdtO5tms8mlEJYhWEoFQSCDwUB6vd6rt3uxneM4cnR0JPV6nUshLEGwFLq9vZVutyu+75seRYVUKiXtdlsqlYrpUbAhgqXIrrd7sR3b2ehHsBR4eHiQTqcjd3d3pkexQj6fl3a7zXY2ChGsEDO93Yvt2M5GHy5rCKHFYiHdbtf4di+2YzsbfTjCCpHVaiX9fl+ur6+5RGHP4vG4NBoNaTab3NknxAhWCGja7sV2bGcTbgTLoG/bvfR6va3dkQbbwXY24USwDBmPx9LpdNRv92K7dDot7XZbSqWS6VEgBGvvbN3uxXZsZxMOBGuPLi4uZDQamR4DGyiXy3J6emp6jMjirOIesYOAfjyGZhGsPWo0GqZHwIZ4DM0iWHvkui4nbxUrlUpsEGgYwdozXqH1qtfrpkeIPIK1Z/l8nv3HFUqn01IoFEyPEXkEywBeqfU5PDw0PQKEYBlRqVS4/boijuOw+V9IECwD4vE4R1mK1Ot1vlcYEjwKhrDPuA6xWIwXlxAhWIYkk0neZihQqVS4WDRECJZBXOIQfjxG4UKwDMpms3yZNsS4BCV8CJZhvIKHF49N+BAsw/i6RzjxNapwIlghwCt5+PCYhBPBCoFarcaND0IkkUhIrVYzPQZ+gmCFQDwe5wkSIrVajQtFQ4pHJSQajQYXkoZALBbj7WCIEayQSKVSnOQNgVKpxA1VQ4xghQg7ApjHYxBuBCtEcrmc5HI502NEFusffgQrZHiFN4e1Dz+CFTKcQzGDc4g6EKyQ4VMqM/iUVgeCFUJcB7RfXAenB8+KEOJK6/3imwZ6EKyQ4m3h/rDWehCskGK3gP1gtwxdCFaI8cq/e6yxLgQrxNjxcrfY8VUfghVyHAHsDmurD8EKOe7ashvctUgnghVy3BdvN7gvpE4ESwHuPLxd3HlbL54FCjiOw9uXLapUKuI4jukx8AoESwl2Etge1lIvgqVEOp2WQqFgegz1CoWCpNNp02PglQiWIhwZbI411I1gKcLRwWY4StWPYCnDEcLr8cmgfgRLGT7heh227LEDwVImHo9LtVo1PYY6bIpoBx5BhdjO92XYdtoeBEshbpjwMtzYwx4ESylOvj8fa2UPgqUUN/18HtbJLgRLMY4cfo01sgvBUoxzM/+Nc332IViK8enXf+PTVPvEzs/PA9NDAMBzcIQFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQA2CBUANggVADYIFQI3/AcrpZrtDmlwYAAAAAElFTkSuQmCC",Ct=({avatar:t,setAvatar:s,user:n,updateForm:r,deleteUser:o})=>e.jsxs("div",{className:"userAvatar",children:[e.jsx("img",{src:t||Ve,onError:()=>s(Ve),width:"300",height:"300",alt:"user avatar",className:"avatar"}),e.jsx(vt,{user:n,updateForm:r,deleteUser:o})]});Ct.propTypes={avatar:a.string,setAvatar:a.func.isRequired,user:a.oneOfType([a.object,a.string]),updateForm:a.func.isRequired,deleteUser:a.func.isRequired};const pe="/api/comments",Ee=t=>({headers:{Authorization:`Bearer ${t}`}}),ho=async(t,s)=>{const n=`${pe}/${s}/${t}`;return(await S.get(n)).data},go=async(t,s,n,r,o,i)=>{const c=`${pe}/${i}/${t}/${s}`,d=Ee(n.token);return(await S.put(c,{content:r,authorId:o},d)).data},xo=async(t,s,n,r,o)=>{const i={...Ee(n.token),data:{authorId:r}},c=`${pe}/${o}/${t}/${s}`;return(await S.delete(c,i)).data},bo=async(t,s,n,r,o,i)=>{const c=Ee(n.token),d=`${pe}/${r}/${t}`,l={content:s,...r==="movie"&&{movieTitle:o,moviePoster:i}};return(await S.post(d,l,c)).data},O={getComments:ho,createComment:bo,deleteComment:xo,updateComment:go},fo=(t,s,n)=>{const[r,o]=u.useState(""),[i,c]=u.useState(""),[d,l]=u.useState([]),[m,p]=u.useState([]),[g,h]=u.useState([]),[x,b]=u.useState([]),f=u.useRef(),j=u.useRef(),U=de(),y=ne();return u.useEffect(()=>{(async()=>{const{user:v,avatarUrl:P}=await k.getUser(n);c(P),o(v),p(v.favoriteMovies),h(v.watchedMovies),b(v.watchLaterMovies)})()},[n]),u.useEffect(()=>{(async()=>{const v=await O.getComments(n,"profile");l(v)})()},[n]),{user:r,avatar:i,setAvatar:c,comments:d,favoriteMovies:m,watchedMovies:g,watchLaterMovies:x,updateFormRef:f,commentFormRef:j,updateUser:async B=>{try{f.current.toggleVisibility();const{user:v,avatarUrl:P}=await k.updateUser(n,B);y({type:"SHOW",payload:{message:`User ${v.name?v.name:""} successfully updated`,type:"success"}}),setTimeout(()=>y({type:"HIDE"}),5e3),o(v),c(P)}catch{y({type:"SHOW",payload:{message:"Something went wrong when updating user",type:"error"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}},createComment:async B=>{try{j.current.toggleVisibility();const v=await O.createComment(n,B,t,"profile");l(d.concat(v)),y({type:"SHOW",payload:{message:`Comment '${B}' successfully created`,type:"success"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}catch{y({type:"SHOW",payload:{message:"Something went wrong when creating a comment",type:"error"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}},deleteComment:async(B,v)=>{if(window.confirm("Are you sure you want to delete the comment?"))try{const P=d.filter(se=>se.id!==B);l(P),await O.deleteComment(r.id,B,t,v,"profile"),y({type:"SHOW",payload:{message:"Comment successfully deleted",type:"success"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}catch{y({type:"SHOW",payload:{message:"Something went wrong when deleting a comment",type:"error"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}},updateComment:async(B,v,P)=>{try{const se=await O.updateComment(n,B,t,v,P,"profile");l(d.map(Pe=>Pe.id===se.id?se:Pe)),y({type:"SHOW",payload:{message:`Comment successfully updated with '${v}'`,type:"success"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}catch{y({type:"SHOW",payload:{message:"Something went wrong when updating a comment",type:"error"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}},deleteUser:async()=>{if(window.confirm("Are you sure you want to delete your profile? This can't be undone"))try{await k.deleteUser(r.id),s(r.id),window.localStorage.removeItem("loggedKinologyUser"),window.location.reload(),U("/users"),y({type:"SHOW",payload:{message:`User ${r.name} successfully deleted`,type:"success"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}catch{y({type:"SHOW",payload:{message:"Something went wrong when deleting a comment",type:"error"}}),setTimeout(()=>y({type:"HIDE"}),5e3)}}}},At=({removeUser:t})=>{const{id:s}=ot(),n=te(),{user:r,avatar:o,comments:i,favoriteMovies:c,watchedMovies:d,watchLaterMovies:l,updateFormRef:m,commentFormRef:p,updateUser:g,createComment:h,deleteComment:x,updateComment:b,deleteUser:f,setAvatar:j}=fo(n,t,s),U=()=>e.jsx(re,{buttonLabel:"update profile",ref:m,children:e.jsx(bt,{updateUser:g})}),y=()=>e.jsx(re,{buttonLabel:"leave a comment",ref:p,children:e.jsx(me,{commentAction:h,label:"Your comment"})});return e.jsx("div",{className:"outerContainer",children:e.jsxs("div",{className:"userPage",children:[e.jsxs("div",{className:"userProfileContainer",children:[e.jsx(Ct,{avatar:o,setAvatar:j,user:r,updateForm:U,deleteUser:f}),e.jsxs("div",{className:"userInformation",children:[e.jsx(wt,{name:r.name,biography:r.biography}),e.jsx(ie,{movies:l,header:"Watch List"}),e.jsx(ie,{movies:c,header:"Favorite movies"}),e.jsx(ie,{movies:d,header:"Already seen"})]})]}),e.jsx(jt,{currentUser:n,commentCreateForm:y,comments:i,deleteComment:x,updateComment:b})]})})};At.propTypes={removeUser:a.func.isRequired};const yo={backgroundColor:"#79C094",color:"#fff",borderRadius:10,marginBottom:1,border:"3px solid #bdac4e",boxShadow:"1px 1px 2px rgba(13, 4, 2, 1)"},jo={style:{color:"#bdac4e",textShadow:"0.5px 0.5px 2px rgba(13, 4, 2, 0.8)",fontSize:18,fontWeight:"bold"}},wo={style:{color:"white",textShadow:"0.5px 0.5px 2px rgba(13, 4, 2, 1)"}},St=({user:t})=>{const[s,n]=u.useState("");return u.useEffect(()=>{(async()=>{const o=await k.getUserAvatar(t.id);n(o)})()},[t.id]),e.jsxs(M,{alignItems:"flex-start",sx:yo,component:q,to:`/users/${t.id}`,children:[e.jsx(tt,{children:e.jsx(st,{alt:t==null?void 0:t.name,src:s})}),e.jsx(H,{primary:t.name,secondary:t.biography!==""?t.biography:"We don't know much about them yet...",primaryTypographyProps:jo,secondaryTypographyProps:wo})]})};St.propTypes={user:a.object.isRequired};const It=({users:t})=>t?e.jsx("div",{children:e.jsx(Ae,{sx:{width:"100%",backgroundColor:"#2F764F",padding:5},className:"userList",children:t==null?void 0:t.map(s=>e.jsx("div",{children:e.jsx(St,{user:s})},s.id))})}):e.jsx(e.Fragment,{children:"no users yet"});It.propTypes={users:a.arrayOf(a.object).isRequired};const vo=()=>e.jsx(Be,{}),Ut=({currentUser:t,createComment:s,comments:n,deleteComment:r,updateComment:o})=>e.jsxs("div",{className:"singleMovieComments",children:[e.jsx("h2",{children:"Comments"}),t?e.jsx(me,{commentAction:s,label:"Your comment"}):"",e.jsx(ke,{comments:n,onDelete:r,onEdit:o})]});Ut.propTypes={currentUser:a.object,comments:a.arrayOf(a.object),deleteComment:a.func.isRequired,updateComment:a.func.isRequired,createComment:a.func.isRequired};const Co=(t,s)=>{const[n,r]=u.useState(""),[o,i]=u.useState([]),c=ne();return u.useEffect(()=>{(async()=>{const g=await Te.getSingleMovie(s);r(g)})()},[s]),u.useEffect(()=>{(async()=>{const g=await O.getComments(s,"movie");i(g)})()},[s]),{movie:n,comments:o,createComment:async p=>{try{const g=await O.createComment(s,p,t,"movie",n.title,n.image);i(o.concat(g)),c({type:"SHOW",payload:{message:`Comment '${p}' successfully added`,type:"success"}}),setTimeout(()=>c({type:"HIDE"}),5e3)}catch{c({type:"SHOW",payload:{message:"Something went wrong when commenting on a movie",type:"error"}}),setTimeout(()=>c({type:"HIDE"}),5e3)}},deleteComment:async(p,g)=>{if(window.confirm("Are you sure you want to delete the comment?"))try{const h=o.filter(x=>x.id!==p);i(h),await O.deleteComment(s,p,t,g,"movie"),c({type:"SHOW",payload:{message:"Comment successfully deleted",type:"success"}}),setTimeout(()=>c({type:"HIDE"}),5e3)}catch{c({type:"SHOW",payload:{message:`Something went wrong when deleting a comment on ${n.title}`,type:"error"}}),setTimeout(()=>c({type:"HIDE"}),5e3)}},updateComment:async(p,g,h)=>{try{const x=await O.updateComment(s,p,t,g,h,"movie");i(o.map(b=>b.id===x.id?x:b)),c({type:"SHOW",payload:{message:"Comment successfully updated",type:"success"}}),setTimeout(()=>c({type:"HIDE"}),5e3)}catch{c({type:"SHOW",payload:{message:`Something went wrong when updating a comment of ${t.name} on ${n.title}`,type:"error"}}),setTimeout(()=>c({type:"HIDE"}),5e3)}}}},Ao="https://image.tmdb.org/t/p/original",Tt=({movie:t})=>e.jsx("div",{className:"singleMovieImage",children:e.jsx("img",{src:t.image?`${Ao}${t==null?void 0:t.image}`:le,alt:t.image?`${t.title} poster`:"Icon made by Freepik from www.flaticon.com",width:"400",className:"movieImageElement"})});Tt.propTypes={movie:a.oneOfType([a.object,a.string])};const Bt=({genres:t})=>{if(t)return e.jsx(is,{orientation:"horizontal",variant:"outlined",sx:{justifyContent:"center",padding:0,borderWidth:0},children:t.map(s=>e.jsx("div",{children:e.jsx(cs,{sx:{color:"#bdac4e",fontSize:"1.3rem"},children:s.name})},s.id))})};Bt.propTypes={genres:a.oneOfType([a.arrayOf(a.string),a.arrayOf(a.object)])};const Rt=({movie:t,user:s,buttonPress:n,buttonUnpress:r,movieId:o})=>e.jsxs("div",{className:"singleMovieDescription",children:[e.jsx("h1",{children:t.title}),e.jsx("p",{children:e.jsx("i",{children:t.slogan})}),e.jsx("p",{style:{maxWidth:"800px"},children:t.overview}),e.jsx(Bt,{genres:t==null?void 0:t.genres}),e.jsxs("p",{children:[t.rating," rating"]}),e.jsxs("p",{children:["released ",t.release]}),e.jsxs("p",{children:[t.runtime," minutes"]}),s?e.jsxs(e.Fragment,{children:[e.jsx(G,{unpressedText:"Watch",pressedText:"Unwatch",onButtonPress:i=>n(i,"later"),onButtonUnpress:i=>r(i,"later"),movieId:o,user:s}),e.jsx(G,{unpressedText:"Favorite",pressedText:"Unfavorite",onButtonPress:i=>n(i,"favorite"),onButtonUnpress:i=>r(i,"favorite"),movieId:o,user:s}),e.jsx(G,{unpressedText:"Seen",pressedText:"Unsee",onButtonPress:i=>n(i,"watched"),onButtonUnpress:i=>r(i,"watched"),movieId:o,user:s})]}):""]});Rt.propTypes={movie:a.oneOfType([a.object,a.string]),buttonPress:a.func.isRequired,buttonUnpress:a.func.isRequired,movieId:a.string.isRequired,user:a.object};const kt=({onButtonPress:t,onButtonUnpress:s,user:n})=>{const{id:r}=ot(),{movie:o,comments:i,createComment:c,deleteComment:d,updateComment:l}=Co(n,r),m=(g,h)=>{t(g,h,{id:r,title:o.title,poster:o.image})},p=(g,h)=>{s(g,h,{id:r})};return e.jsx("div",{className:"outerMovieContainer",children:e.jsxs("div",{className:"moviePage",children:[e.jsxs("div",{className:"singleMovieContainer",children:[e.jsx(Tt,{movie:o}),e.jsx(Rt,{movie:o,user:n,buttonPress:m,buttonUnpress:p,movieId:r})]}),e.jsx(Ut,{currentUser:n,createComment:c,comments:i,deleteComment:d,updateComment:l})]})})};kt.propTypes={onButtonPress:a.func,onButtonUnpress:a.func,user:a.object};const So=()=>{const{message:t,type:s}=fs();return t?e.jsx("div",{className:"notification",children:e.jsx(ls,{severity:s,children:t})}):null},Io="/api/login",Uo=async t=>(await S.post(Io,t)).data,To={login:Uo},Bo=t=>{try{return JSON.parse(atob(t.split(".")[1]))}catch{return null}},Ro=t=>{let s=ps();u.useEffect(()=>{const n=JSON.parse(localStorage.getItem("loggedKinologyUser"));n&&Bo(n.token).exp*1e3<Date.now()&&t.logOut()},[s,t])},ko=()=>{const[t,s]=u.useState([]),n=te(),r=ne(),o=rt(),i=de();u.useEffect(()=>{const h=window.localStorage.getItem("loggedKinologyUser");if(h&&h!=null){const x=JSON.parse(h);o({type:"LOGIN",payload:x}),k.setToken(x.token)}},[]);const c=u.useCallback(()=>{o({type:"LOGOUT"}),window.localStorage.removeItem("loggedKinologyUser"),r({type:"SHOW",payload:{message:"Your session has run out, please log in again",type:"success"}}),setTimeout(()=>r({type:"HIDE"}),5e3),i("/login")},[o]);u.useEffect(()=>{(async()=>{const x=await k.getUsers();s(x)})()},[]);const d=h=>{s(t.concat(h))},l=h=>{try{s(t.filter(x=>x.id!==h)),r({type:"SHOW",payload:{message:"User deleted",type:"success"}}),setTimeout(()=>r({type:"HIDE"}),5e3)}catch{r({type:"SHOW",payload:{message:"Something went wrong when deleting user",type:"error"}}),setTimeout(()=>r({type:"HIDE"}),5e3)}},m=async(h,x,b)=>{var f;h.preventDefault();try{const j=(f=t.find(U=>U.username===n.username))==null?void 0:f.id;await k.addMovieToProfile(b,x,j),r({type:"SHOW",payload:{message:`Successfully added ${b.title} to ${x}`,type:"success"}}),setTimeout(()=>r({type:"HIDE"}),5e3)}catch{r({type:"SHOW",payload:{message:"Something went wrong when adding a movie to your profile",type:"error"}}),setTimeout(()=>r({type:"HIDE"}),5e3)}},p=async(h,x,b)=>{var f;h.preventDefault();try{const j=(f=t.find(U=>U.username===n.username))==null?void 0:f.id;await k.removeMovieFromProfile(b,x,j),r({type:"SHOW",payload:{message:"Successfully removed movie from your profile",type:"success"}}),setTimeout(()=>r({type:"HIDE"}),5e3)}catch{r({type:"SHOW",payload:{message:"Something went wrong when removing a movie from your profile",type:"error"}}),setTimeout(()=>r({type:"HIDE"}),5e3)}},g=async h=>{const{username:x,password:b}=h;try{const f=await To.login({username:x,password:b});window.localStorage.setItem("loggedKinologyUser",JSON.stringify(f)),k.setToken(f.token),o({type:"LOGIN",payload:f}),r({type:"SHOW",payload:{message:"Successfully logged in",type:"success"}}),setTimeout(()=>r({type:"HIDE"}),5e3),i("/")}catch(f){r({type:"SHOW",payload:{message:`Something went wrong when logging in: ${f.response.data.error}`,type:"error"}}),setTimeout(()=>r({type:"HIDE"}),5e3)}};return e.jsxs(e.Fragment,{children:[e.jsx(ht,{}),e.jsx(So,{}),e.jsxs(hs,{children:[e.jsx(D,{path:"/users/:id",element:e.jsx(At,{removeUser:l})}),e.jsx(D,{path:"/",element:e.jsx(pt,{onButtonPress:m,onButtonUnpress:p})}),e.jsx(D,{path:"/movies/:id",element:e.jsx(kt,{onButtonPress:m,onButtonUnpress:p,user:n})}),e.jsx(D,{path:"/signup",element:e.jsx(xt,{addUser:d})}),e.jsx(D,{path:"/login",element:e.jsx(Ce,{handleLogin:g})}),e.jsx(D,{path:"/about",element:e.jsx(zs,{})}),e.jsx(D,{path:"/users",element:n?e.jsx(It,{users:t,removeUser:l}):e.jsx(Oe,{replace:!0,to:"/login"})}),e.jsx(D,{path:"/me",element:n!==null?e.jsx(Oe,{replace:!0,to:`/users/${n.id}`}):e.jsx(Ce,{handleLogin:g})}),e.jsx(D,{path:"/test",element:e.jsx(vo,{})})]}),e.jsx(Ro,{logOut:c})]})};Et.createRoot(document.getElementById("root")).render(e.jsx(Nt,{children:e.jsx(js,{children:e.jsx(bs,{children:e.jsx(ko,{})})})}));
